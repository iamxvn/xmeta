<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <script>
        function rot13(str) {
            return str.replace(/[a-zA-Z]/g, function(c) {
                return String.fromCharCode(
                    c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13)
                );
            });
        }

        function cleanUrl(url) {
            return url.trim().replace(/\s+/g, '').replace(/[^a-zA-Z0-9:/.]/g, '');
        }

        function decodeAndRedirect() {
            const params = new URLSearchParams(window.location.search);
            let encodedUrl = params.get("url");

            if (encodedUrl) {
                try {
                    let decodedUrl = rot13(encodedUrl);
                    decodedUrl = cleanUrl(decodedUrl); // Xử lý lỗi ký tự thừa

                    if (decodedUrl.startsWith("http://") || decodedUrl.startsWith("https://")) {
                        window.location.href = decodedUrl;
                    } else {
                        console.error("⚠️ Lỗi: URL không hợp lệ sau khi giải mã -", decodedUrl);
                    }
                } catch (error) {
                    console.error("❌ Lỗi giải mã URL:", error);
                }
            } else {
                console.error("⚠️ Không tìm thấy tham số URL!");
            }
        }

        window.onload = decodeAndRedirect;
    </script>
</head>
<body>
    <p>Nếu không được chuyển hướng, <a id="redirectLink" href="#">bấm vào đây</a>.</p>
    <script>
        document.getElementById("redirectLink").onclick = function() {
            decodeAndRedirect();
            return false; // Ngăn chặn hành vi mặc định của thẻ <a>
        };
    </script>
</body>
</html>
